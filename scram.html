<!DOCTYPE html>
<!----------------------!
 ! SJ-Static | by VAPOR
 !---------------------->
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vapor scramjet not skid frfrfr</title>

  <link rel="stylesheet" href="https://vapor.my/styles/defaults.css" />
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
   /* Pastel Green Theme with Animations - CSS only (override + enhancements)
      Note: This focuses on a pastel green palette and richer animations.
      It also includes aggressive overrides to discourage external theming where possible. */

   /* 1) Pastel green palette (override defaults) */
:root {
  --bg: #eaf6ea;           /* pale pastel green background */
  --secondary-bg: #d2f0dc;
  --third-bg: #c7e9d5;
  --fourth-bg: #b5e6cf;
  --primary: #7bd29a;        /* soft green accent */
  --secondary: #63c88a;      /* softer secondary green */
  --text-color: #1b2f22;      /* dark text on light bg for readability */
  --secondary-text-color: #2c5a38;
  --button-bg: #cfeedb;        /* light green buttons */
  --button-hover: #a7e6c3;
  --gradient-start: #d9f8e1;
  --gradient-end: #bdebd0;
}

 /* 2) General ergonomic/readability tweaks (new + preserve existing) */
html, body {
  font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  width: 100vw;
  height: 100vh;
  margin: 0;
  padding: 0;
  background: var(--bg);
  overflow: hidden;
  color: var(--text-color);
  /* Subtle animated background gradient for depth */
  background: linear-gradient(135deg, var(--bg) 0%, var(--secondary-bg) 40%, var(--third-bg) 100%);
  background-size: 200% 200%;
  animation: gradientShift 30s ease infinite;
  transition: background-color 0.3s ease;
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

img { pointer-events: none; }

/* Subtle text selection for aesthetics on pastel bg */
::-moz-selection { color: var(--bg); background: var(--text-color); }
::selection { color: var(--bg); background: var(--text-color); }

/* Scrollbar tweaks for a softer UI */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { border-radius: 6px; background: var(--fourth-bg); transition: 0.3s; }
::-webkit-scrollbar-thumb:hover { background: var(--third-bg); }

/* Base UI surface styling (kept, but softened) */
.badge { text-transform: uppercase; font-size: 12px; background: #ffffff30; border-radius: 6px; opacity: 0.92; padding: 1px 4px; }

.redbadge {
  text-transform: uppercase;
  font-size: 12px;
  color: #e54848;
  background: #e5484860;
  border-radius: 6px;
  opacity: 0.9;
  padding: 1px 4px;
}

/* 3) Core layout rules (unchanged but prepared for overrides) */
body,
html,
#app {
  width: 100vw;
  height: 100vh;
  margin: 0;
  padding: 0;
  font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  overflow: hidden;
}

@keyframes fade { from { opacity: 0; } to { opacity: 1; } }
@keyframes spin { to { transform: rotate(360deg); } }

/* Flex helpers */
.flex { display: flex; }
.col { flex-direction: column; }

/* 4) Main app chrome styling with pastel accents */
.browser-container {
  width: 100%;
  height: 100%;
  color: var(--text-color);
  display: flex;
  flex-direction: column;
  padding: 0.5em;
  padding-top: 0;
  box-sizing: border-box;
}

.browser-container a { color: var(--primary); }

/* Inputs/Buttons look-and-feel (ergonomic) */
.browser-container input,
.browser-container button {
  font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

h1 { font-family: inherit; }

/* The main content area (iframe) */
.browser-container iframe {
  background-color: #fff;
  border: none;
  border-radius: 12px;
  flex: 1;
  width: 100%;
  /* gentle entrance animation for iframes */
  animation: fadeIn 0.5s ease both;
}
@keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

/* Address bar styling (bolder tap targets) */
input.bar {
  font-family: "Inter";
  padding: 0.6rem 1rem;
  border: none;
  outline: none;
  color: var(--text-color);
  height: auto;
  border-radius: 8px;
  flex: 1;
  background: var(--button-bg);
  font-size: 1.05rem;
  transition: 0.2s ease;
}
input.bar:focus { background-color: var(--button-hover); }

/* Navigation/buttons layout */
.nav {
  padding-top: 0.6rem;
  padding-bottom: 0.6rem;
  gap: 0.5rem;
}
.nav button {
  color: var(--text-color);
  outline: none;
  border: none;
  border-radius: 8px;
  background: var(--button-bg);
  padding: 0.6rem 1rem;
  cursor: pointer;
  transition: 0.2s ease;
  font-size: 1.1rem;
  /* add a subtle tilt on hover for feedback */
  transform-origin: center;
}
.nav button:hover { background-color: var(--button-hover); transform: translateY(-1px) scale(1.02); }

/* Tabs (row of open pages) */
.tabs {
  padding-top: 0.6rem;
  padding-bottom: 0rem;
  gap: 0.3rem;
  overflow-x: auto;
  overflow-y: hidden;
  white-space: nowrap;
}
.tabs::-webkit-scrollbar { height: 4px; }
.tabs::-webkit-scrollbar-thumb { background: var(--third-bg); border-radius: 2px; }

/* Individual tab styling with animations for nicer feel */
.tab {
  color: var(--text-color);
  outline: none;
  border: none;
  border-radius: 8px;
  background: var(--button-bg);
  padding: 0.5rem 1rem;
  width: 245px;
  min-width: 245px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 0.6rem;
  cursor: pointer;
  flex-shrink: 0;
  transition: 0.25s ease;
  font-size: 1rem;
  /* soft entrance and hover feedback */
  animation: slideIn 0.4s ease forwards;
  transform-origin: center;
}
@keyframes slideIn {
  from { opacity: 0; transform: translateY(-6px); }
  to   { opacity: 1; transform: translateY(0); }
}
.tab.active { background-color: var(--button-hover); box-shadow: 0 0 0 2px rgba(123,210,154,.35); }
.tab:hover:not(.active) { background-color: var(--third-bg); transform: translateY(-2px); }

/* Favicon + title inside tab */
.tab-favicon { width: 18px; height: 18px; flex-shrink: 0; border-radius: 4px; }
.tab-title { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

/* Close button in tabs */
.tab-close {
  background: none;
  border: none;
  color: var(--secondary-text-color);
  cursor: pointer;
  padding: 0;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  flex-shrink: 0;
  transition: 0.2s ease;
  font-size: 1.2rem;
}
.tab-close:hover { background-color: var(--third-bg); color: var(--text-color); }

/* New tab button styling */
.new-tab {
  color: var(--text-color);
  outline: none;
  border: none;
  border-radius: 8px;
  background: var(--button-bg);
  padding: 0.7rem;
  cursor: pointer;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  transition: 0.2s ease;
  font-size: 1.3rem;
}
.new-tab:hover { background-color: var(--button-hover); }

/* 5) Focus accessibility helpers (keyboard nav) */
:focus-visible {
  outline: 3px solid var(--secondary);
  outline-offset: 2px;
  border-radius: 6px;
}
button:focus-visible,
input.bar:focus-visible,
.tab:focus-visible,
.tab-close:focus-visible {
  outline: 3px solid var(--secondary);
  outline-offset: 2px;
  border-radius: 6px;
  box-shadow: 0 0 0 4px rgba(123,210,154,.25);
}

/* 6) Animations to enliven interactions (additional) */
@keyframes glowPulse {
  0%, 100% { box-shadow: 0 0 0 rgba(0,0,0,0); }
  50% { box-shadow: 0 0 14px rgba(123,210,154,0.9); }
}
.iframe-container { animation: fadeIn 0.6s ease both; }

/* Gentle hover glow for actionable controls */
.nav button, .new-tab, .tab-close { box-shadow: 0 1px 0 rgba(0,0,0,.04); }

/* 7) Make themes less impactful (override external theme CSS where possible) */
html, body { background: linear-gradient(135deg, var(--bg) 0%, var(--secondary-bg) 40%, var(--third-bg) 100%) !important; color: var(--text-color) !important; }

/* Force common UI colors to pastel overrides (even if a theme tries to override) */
a { color: var(--primary) !important; }
.browser-container a { color: var(--primary) !important; }

/* Optional: hide theme-related UI if present (best-effort) */
#themeStylesheet, link#themeStylesheet { display: none !important; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/dreamland"></script>
  <script src="/baremux/index.js"></script>
  <script src="/scram/scramjet.all.js"></script>
  <script src="/assets/config.js"></script>
</head>

<body>
  <div id="app"></div>
  <script>
    const { ScramjetController } = $scramjetLoadController();
    
    const scramjet = new ScramjetController({
      files: {
        wasm: "/scram/scramjet.wasm.wasm",
        all: "/scram/scramjet.all.js",
        sync: "/scram/scramjet.sync.js",
      },
    });
    
    scramjet.init();
    navigator.serviceWorker.register("./sw.js");


    const connection = new BareMux.BareMuxConnection("/baremux/worker.js");


    const store = {
      url: "https://",
      wispurl: localStorage.getItem("proxServer") || "wss://gointospace.app/wisp/",
      bareurl:
        _CONFIG?.bareurl ||
        (location.protocol === "https:" ? "https" : "http") +
        "://" +
        location.host +
        "/bare/",
      proxy: "",
    };

    connection.setTransport("/epoxy/index.mjs", [{ wisp: store.wispurl }]);

    // tab management
    let tabs = [];
    let activeTabId = 1;
    let nextTabId = 2;
    let sortableInstance = null;

    function getFaviconUrl(url) {
      try {
        const domain = new URL(url).origin;
        return `https://t0.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${encodeURIComponent(
          domain
        )}`;
      } catch {
        return `https://t0.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${encodeURIComponent(
          url
        )}`;
      }
    }

    function createTab() {
      const frame = scramjet.createFrame();
      const tab = {
        id: nextTabId++,
        title: "New Tab",
        url: "https://start.duckduckgo.com/",
        frame: frame,
        favicon: getFaviconUrl("https://start.duckduckgo.com"),
      };

      frame.frame.src = "/page/newtab.html";

      frame.addEventListener("urlchange", (e) => {
        if (!e.url) return;
        tab.url = e.url;
        tab.favicon = getFaviconUrl(e.url);

        try {
          const title =
            frame.frame.contentWindow?.document?.title ||
            new URL(e.url).hostname;
          tab.title = title || "...";
        } catch (err) {
          tab.title = new URL(e.url).hostname || "...";
        }

        updateTabsUI();
        updateAddressBar();
      });

      tabs.push(tab);
      return tab;
    }

    function getActiveTab() {
      return tabs.find((tab) => tab.id === activeTabId);
    }

    function switchTab(tabId) {
      tabs.forEach((tab) => {
        tab.frame.frame.classList.add("hidden");
      });

      activeTabId = tabId;
      const activeTab = getActiveTab();
      if (activeTab) {
        activeTab.frame.frame.classList.remove("hidden");
      }

      updateTabsUI();
      updateAddressBar();
    }

    function closeTab(tabId) {
      const tabIndex = tabs.findIndex((tab) => tab.id === tabId);
      if (tabIndex === -1) return;

      const tab = tabs[tabIndex];


      if (tabs.length === 1) {
        const newTab = createTab();
        document.getElementById("iframe-container").appendChild(newTab.frame.frame);
        switchTab(newTab.id);
      }

      if (tab.frame.frame.parentNode) {
        tab.frame.frame.parentNode.removeChild(tab.frame.frame);
      }

      tabs.splice(tabIndex, 1);


      if (activeTabId === tabId && tabs.length > 0) {
        const newActiveIndex = Math.min(tabIndex, tabs.length - 1);
        activeTabId = tabs[newActiveIndex].id;
        switchTab(activeTabId);
      } else {
        updateTabsUI();
      }
    }

    function updateTabsUI() {
      const tabsContainer = document.getElementById("tabs-container");
      if (!tabsContainer) return;

      tabsContainer.innerHTML = "";

      tabs.forEach((tab) => {
        const tabElement = document.createElement("div");
        tabElement.className = `tab ${tab.id === activeTabId ? "active" : ""
          }`;
        tabElement.setAttribute("data-tab-id", tab.id);
        tabElement.onclick = () => switchTab(tab.id);

        const faviconImg = document.createElement("img");
        faviconImg.className = "tab-favicon";
        faviconImg.src = tab.favicon;
        faviconImg.alt = "";
        faviconImg.onerror = () => {
          faviconImg.style.display = "none";
        };

        const titleSpan = document.createElement("span");
        titleSpan.className = "tab-title";
        titleSpan.textContent = tab.title;

        const closeButton = document.createElement("button");
        closeButton.className = "tab-close";
        closeButton.textContent = "×";
        closeButton.onclick = (e) => {
          e.stopPropagation();
          closeTab(tab.id);
        };

        tabElement.appendChild(faviconImg);
        tabElement.appendChild(titleSpan);
        tabElement.appendChild(closeButton);
        tabsContainer.appendChild(tabElement);
      });

      const newTabButton = document.createElement("button");
      newTabButton.className = "new-tab";
      newTabButton.textContent = "+";
      newTabButton.onclick = () => {
        const newTab = createTab();
        document
          .getElementById("iframe-container")
          .appendChild(newTab.frame.frame);
        switchTab(newTab.id);
      };
      tabsContainer.appendChild(newTabButton);

      if (sortableInstance) {
        sortableInstance.destroy();
      }

      sortableInstance = new Sortable(tabsContainer, {
        animation: 200,
        direction: "horizontal",
        ghostClass: "sortable-ghost",
        dragClass: "sortable-drag",
        filter: ".new-tab",
        onStart: () => {
          tabsContainer
            .querySelectorAll(".tab:not(.sortable-ghost)")
            .forEach((t) => {
              t.style.opacity = "0.5";
            });
        },
        onEnd: (evt) => {
          tabsContainer.querySelectorAll(".tab").forEach((t) => {
            t.style.opacity = "1";
          });

          if (evt.oldIndex !== evt.newIndex) {
            const movedTab = tabs.splice(evt.oldIndex, 1)[0];
            tabs.splice(evt.newIndex, 0, movedTab);
          }
        },
      });
    }

    function updateAddressBar() {
      const addressBar = document.getElementById("address-bar");
      const activeTab = getActiveTab();
      if (addressBar && activeTab) {
        addressBar.value = activeTab.url;
      }
    }

    function handleSubmit() {
      const activeTab = getActiveTab();
      const addressBar = document.getElementById("address-bar");
      if (!activeTab || !addressBar) return;

      let url = addressBar.value.trim();


      if (!url.startsWith("http") && !url.includes(".")) {

        url = "https://duckduckgo.com/?q=" + encodeURIComponent(url);
      } else if (!url.startsWith("http")) {

        url = "https://" + url;
      }

      activeTab.url = url;
      activeTab.favicon = getFaviconUrl(url);
      return activeTab.frame.go(url);
    }

    window.addEventListener("load", async () => {
      const root = document.getElementById("app");

      root.innerHTML = `
          <div class="browser-container">
            <div class="flex tabs" id="tabs-container">
            </div>

            <div class="flex nav">
              <button onclick="getActiveTab()?.frame.back()"><i class="fa-regular fa-chevron-left"></i></button>
              <button onclick="getActiveTab()?.frame.forward()"><i class="fa-regular fa-chevron-right"></i></button>
              <button onclick="getActiveTab()?.frame.reload()"><i class="fa-regular fa-rotate-right"></i></button>

              <input class="bar" id="address-bar" autocomplete="off" autocapitalize="off" autocorrect="off" 
                onkeyup="event.keyCode === 13 && handleSubmit()">

              <button onclick="window.open(scramjet.encodeUrl(getActiveTab()?.url))"><i class="fa-regular fa-arrow-up-right-from-square"></i></button>

              <p class="version">
                <b></b>
              </p>
            </div>

            <div class="iframe-container" id="iframe-container">
            </div>
          </div>
        `;

      const initialTab = createTab();
      document
        .getElementById("iframe-container")
        .appendChild(initialTab.frame.frame);
      switchTab(initialTab.id);
      updateTabsUI();

      try {
        function b64(buffer) {
          let binary = "";
          const bytes = new Uint8Array(buffer);
          const len = bytes.byteLength;
          for (let i = 0; i < len; i++) {
            binary += String.fromCharCode(bytes[i]);
          }
          return btoa(binary);
        }
        const arraybuffer = await (
          await fetch("/assets/scramjet.png")
        ).arrayBuffer();
        console.log(
          "%cb",
          `
              background-image: url(data:image/png;base64,${b64(arraybuffer)});
              color: transparent;
              padding-left: 200px;
              padding-bottom: 100px;
              background-size: contain;
              background-position: center center;
              background-repeat: no-repeat;
          `
        );
      } catch (e) {
        // naw
      }
    });
  </script>
</body>

</html>
