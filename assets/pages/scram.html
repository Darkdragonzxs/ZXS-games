<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>grog yes to</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@800&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Fredoka', sans-serif;
      font-weight: 800;
      background: #0a0a0a;
      color: #a8ffbf;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .toolbar {
      display: flex;
      align-items: center;
      padding: 10px;
      background: #111;
      box-shadow: 0 2px 8px rgba(168, 255, 191, 0.1);
    }

    .toolbar button {
      color: #a8ffbf;
      background: #1a1a1a;
      border: none;
      font-size: 22px;
      margin: 0 6px;
      padding: 8px 12px;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .toolbar button:hover:enabled {
      transform: scale(1.2);
      box-shadow: 0 0 10px #a8ffbf;
    }

    .toolbar button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    #addressBar {
      flex: 1;
      margin-left: 6px;
      background: #1a1a1a;
      border: 2px solid #2f4f3f;
      color: #a8ffbf;
      font-size: 16px;
      padding: 10px 14px;
      border-radius: 20px;
      outline: none;
      transition: box-shadow 0.3s ease;
    }

    #addressBar:focus {
      box-shadow: 0 0 12px #a8ffbf;
    }

    #addressBar::placeholder {
      color: #5f7f6b;
    }

    #view {
      flex: 1;
      width: 100%;
      border: none;
      background: #0a0a0a;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    #view.loaded {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <button id="backBtn">⯇</button>
    <button id="forwardBtn">⯈</button>
    <button id="reloadBtn">⟳</button>
    <input id="addressBar" type="text" placeholder="Enter URL or search...">
  </div>
  <iframe id="view"></iframe>

<script>
  const iframe = document.getElementById('view');
  const addressBar = document.getElementById('addressBar');
  const backBtn = document.getElementById('backBtn');
  const forwardBtn = document.getElementById('forwardBtn');
  const reloadBtn = document.getElementById('reloadBtn');

  let historyStack = [];
  let historyIndex = -1;

  function isLikelyUrl(input) {
    return /^https?:\/\//i.test(input) || /^[\w.-]+\.[a-z]{2,}/i.test(input);
  }

  function normalizeUrl(input) {
    if (/^https?:\/\//i.test(input)) return input;
    return "https://" + input;
  }

  function updateButtons() {
    backBtn.disabled = historyIndex <= 0;
    forwardBtn.disabled = historyIndex >= historyStack.length - 1;
  }

  function renderHome(pushHistory = true) {
    iframe.removeAttribute("src");
    iframe.removeAttribute("srcdoc");
    iframe.srcdoc = `
      <style>
        body { background:#0a0a0a; color:#a8ffbf; font-family:'Fredoka',sans-serif; font-weight:800; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; }
        h1 { font-size:32px; margin-bottom:10px; text-shadow:0 0 6px #a8ffbf; }
        p { font-size:18px; margin-bottom:30px; color:#7fbf9f; }
        .shortcuts { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:20px; width:80%; max-width:600px; }
        .shortcut { background:#1a1a1a; color:#a8ffbf; padding:14px 18px; border-radius:20px; text-align:center; cursor:pointer; transition:transform 0.2s ease, box-shadow 0.2s ease; }
        .shortcut:hover { transform:translateY(-4px); box-shadow:0 0 12px #a8ffbf; }
      </style>
      <body>
        <h1>Welcome Home</h1>
        <p>Choose your destination:</p>
        <div class="shortcuts">
          <div class="shortcut" onclick="parent.loadPage('https://search.brave.com', true, true)">Brave</div>
          <div class="shortcut" onclick="parent.loadPage('https://wikipedia.org', true, true)">Wikipedia</div>
          <div class="shortcut" onclick="parent.loadPage('https://github.com', true, true)">GitHub</div>
          <div class="shortcut" onclick="parent.loadPage('https://reddit.com', true, true)">Reddit</div>
          <div class="shortcut" onclick="parent.loadPage('https://youtube.com', true, true)">YouTube</div>
        </div>
      </body>
    `;
    addressBar.value = "zxs://home";

    if (pushHistory && historyStack[historyIndex] !== "zxs://home") {
      historyStack = historyStack.slice(0, historyIndex + 1);
      historyStack.push("zxs://home");
      historyIndex++;
    }
    updateButtons();
  }

  // trustUrl = true means skip search logic
  function loadPage(input, pushHistory = true, trustUrl = false) {
    let url = input.trim();

    if (!url || url === "zxs://home") {
      renderHome(pushHistory);
      return;
    }

    if (!trustUrl) {
      if (isLikelyUrl(url)) {
        url = normalizeUrl(url);
      } else {
        url = "https://search.brave.com/search?q=" + encodeURIComponent(url);
      }
    }

    iframe.removeAttribute("srcdoc");
    iframe.src = "about:blank";
    void iframe.offsetHeight; // force reflow
    iframe.classList.remove("loaded");

    iframe.src = "/scramjet/" + encodeURIComponent(url);
    addressBar.value = url;

    if (pushHistory && historyStack[historyIndex] !== url) {
      historyStack = historyStack.slice(0, historyIndex + 1);
      historyStack.push(url);
      historyIndex++;
    }

    updateButtons();
  }

  addressBar.addEventListener("keydown", e => {
    if (e.key === "Enter") {
      const val = addressBar.value.trim();
      if (val) loadPage(val, true, false);
    }
  });

  backBtn.addEventListener("click", () => {
    if (historyIndex > 0) {
      historyIndex--;
      loadPage(historyStack[historyIndex], false, true);
    }
  });

  forwardBtn.addEventListener("click", () => {
    if (historyIndex < historyStack.length - 1) {
      historyIndex++;
      loadPage(historyStack[historyIndex], false, true);
    }
  });

  reloadBtn.addEventListener("click", () => {
    if (historyIndex >= 0) {
      loadPage(historyStack[historyIndex], false, true);
    }
  });

  iframe.addEventListener("load", () => {
    iframe.classList.add("loaded");
  });

  // Initial load
  renderHome(true);
</script>
  <script src="/baremux/index.js"></script>
  <script src="/scram/scramjet.all.js"></script>
  <script src="/assets/config.js"></script>
  <script>
    const { ScramjetController } = $scramjetLoadController();
    
    const scramjet = new ScramjetController({
      files: {
        wasm: "/scram/scramjet.wasm.wasm",
        all: "/scram/scramjet.all.js",
        sync: "/scram/scramjet.sync.js",
      },
    });
    
    scramjet.init();
    navigator.serviceWorker.register("./sw.js");


    const connection = new BareMux.BareMuxConnection("/baremux/worker.js");

    const store = {
      url: "https://",
      wispurl: localStorage.getItem("proxServer") || "wss://gointospace.app/wisp/",
      bareurl:
        _CONFIG?.bareurl ||
        (location.protocol === "https:" ? "https" : "http") +
        "://" +
        location.host +
        "/bare/",
      proxy: "",
    };

    connection.setTransport("/epoxy/index.mjs", [{ wisp: store.wispurl }]);
  </script>
</body>
</html>
