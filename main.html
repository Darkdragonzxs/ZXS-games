<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ZXS Dashboard</title>
  <link rel="icon" href="/logo.png" id="favicon" type="image/png"/>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One:wght@400;700;900&display=swap" rel="stylesheet"/>
  <meta name="description" content="A Gaming Site with everything you need." />
  <style>
    :root {
      --accent: #00ff5e;
      --bg: #020402;
      --tile-bg: #121212;
      --tile-hover-bg: #1a1a1a;
      --text-main: #eaffea;
      --font-big: 'Russo One', sans-serif;
      --button-radius: 18px;
      --topbar-height: 56px;
      --topbar-bg: #191919ee;
      --popup-bg: #181818f2;
      --transition-fast: 0.18s;
      --transition-medium: 0.3s;
      --transition-slow: 0.45s;
    }
    
    html, body {
      margin: 0;
      padding: 0;
      font-family: var(--font-big);
      background: var(--bg);
      color: var(--accent);
      min-height: 100vh;
      width: 100vw;
      box-sizing: border-box;
      overflow-x: hidden;
      max-width: 100vw;
    }
    
    *, *::before, *::after {
      box-sizing: inherit;
      max-width: 100%;
    }
    
    /* Screen reader only content */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    /* Focus styles for accessibility */
    button:focus-visible, input:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    #particles-js {
      position: fixed;
      width: 100vw;
      height: 100vh;
      top: 0;
      left: 0;
      z-index: 0;
      opacity: 0.12;
      pointer-events: none;
    }
    
    .dashboard-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      width: 100vw;
      z-index: 1;
      position: relative;
      padding-top: 5vh;
      padding-bottom: 4vh;
    }
    
    .main-block {
      background: var(--tile-bg);
      border-radius: 32px;
      box-shadow: 0 2px 32px rgba(0, 0, 0, 0.6);
      padding: 40px 32px;
      max-width: 550px;
      width: 98vw;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 36px;
      transition: opacity var(--transition-medium), transform var(--transition-medium);
    }
    
    .main-logo {
      width: 120px;
      height: 120px;
      object-fit: contain;
      border-radius: 22px;
      background: #191919;
      margin-bottom: 32px;
      border: 3px solid var(--accent);
      transition: transform var(--transition-fast);
    }
    
    .main-logo:hover {
      transform: scale(1.05);
    }
    
    .main-title {
      font-size: 2.7rem;
      font-family: var(--font-big);
      font-weight: 900;
      color: var(--accent);
      letter-spacing: 0.24em;
      text-align: center;
      margin-bottom: 18px;
      margin-top: 0;
      user-select: none;
    }
    
    .main-subtitle {
      font-size: 1.18rem;
      color: var(--accent);
      text-align: center;
      margin-bottom: 22px;
      margin-top: 0;
      opacity: 0.8;
    }
    
    .random-message {
      font-size: 1.05rem;
      color: var(--bg);
      background: var(--accent);
      border-radius: 12px;
      border: none;
      padding: 16px 20px;
      margin-bottom: 32px;
      margin-top: 0;
      min-height: 38px;
      text-align: center;
      font-family: var(--font-big);
      font-weight: 700;
      animation: fadeIn 0.6s ease-out;
      transition: background var(--transition-fast), color var(--transition-fast);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .dashboard-actions {
      width: 100vw;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 36px;
      margin: 0;
      padding: 0;
      position: fixed;
      left: 0;
      top: 0;
      background: var(--tile-bg);
      z-index: 101;
      transition: opacity var(--transition-medium);
    }
    
    .dashboard-action {
      background: var(--accent);
      color: var(--bg);
      border-radius: var(--button-radius);
      font-family: var(--font-big);
      font-weight: 900;
      font-size: 1.4rem;
      padding: 20px 0;
      border: none;
      cursor: pointer;
      margin: 0;
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
      outline: none;
      letter-spacing: 0.1em;
      width: 50vw;
      max-width: 640px;
      text-align: center;
    }
    
    .dashboard-action:hover, .dashboard-action:focus-visible {
      background: var(--tile-hover-bg);
      color: var(--accent);
      transform: translateY(-2px);
    }
    
    .dashboard-action:active {
      transform: translateY(0);
    }
    
    .dashboard-wrap .main-block .dashboard-actions {
      position: static;
      width: 100%;
      min-height: unset;
      gap: 16px;
      background: none;
      z-index: 1;
      padding: 0;
    }
    
    .fullscreen-content {
      display: none;
      position: fixed;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      background: var(--bg);
      z-index: 99;
      justify-content: center;
      align-items: center;
      animation: fadeIn var(--transition-slow);
    }
    
    .fullscreen-content.active {
      display: flex;
      flex-direction: column;
    }
    
    .fullscreen-iframe {
      width: 100vw;
      height: calc(100vh - var(--topbar-height));
      border: none;
      background: var(--bg);
      z-index: 100;
    }
    
    #fullscreen-settings {
      width: 100vw;
      height: 100vh;
      background: var(--bg);
      display: none;
      position: fixed;
      left: 0;
      top: 0;
      z-index: 150;
      overflow-y: auto;
      justify-content: center;
      align-items: center;
    }
    
    #fullscreen-settings.active {
      display: flex;
    }
    
    .settings-panel {
      background: var(--tile-bg);
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
      padding: 20px 0;
      max-width: 900px;
      width: 96vw;
      max-height: 90vh;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 151;
      overflow-y: auto;
      overflow-x: hidden;
    }
    
    .settings-panel h2 {
      font-size: 2rem;
      color: var(--accent);
      margin-bottom: 36px;
      margin-top: 0;
      font-weight: 900;
      text-align: left;
      letter-spacing: 0.08em;
      width: 100%;
      font-family: var(--font-big);
    }
    
    .settings-section {
      width: 90%;
      display: flex;
      flex-direction: column;
      gap: 36px;
      border: none;
      padding: 0;
      margin: 0;
    }
    
    .settings-row {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 18px;
      border: none;
      padding: 0;
      margin: 0;
    }
    
    .settings-panel label, .settings-panel legend {
      font-size: 1.18rem;
      color: var(--accent);
      font-weight: 700;
      margin-bottom: 8px;
      display: block;
      margin-top: 0;
      font-family: var(--font-big);
      text-align: left;
      width: 100%;
    }
    
    .settings-panel input[type="text"], .settings-panel input[type="url"] {
      width: 100%;
      border-radius: 9px;
      border: 1.5px solid var(--accent);
      padding: 13px 14px;
      background: var(--tile-bg);
      color: var(--accent);
      font-family: var(--font-big);
      font-size: 1.18rem;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
    }
    
    .settings-panel input:focus {
      border-color: var(--text-main);
      box-shadow: 0 0 0 2px rgba(0, 255, 94, 0.2);
    }
    
    .settings-panel button {
      background: var(--accent);
      color: var(--bg);
      border-radius: 12px;
      font-family: var(--font-big);
      font-size: 1.18rem;
      padding: 18px 0;
      border: none;
      cursor: pointer;
      margin: 0;
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
      outline: none;
      letter-spacing: 0.09em;
      width: 100%;
      font-weight: 700;
    }
    
    .settings-panel button:hover, .settings-panel button:focus-visible {
      background: var(--tile-hover-bg);
      color: var(--accent);
      transform: translateY(-1px);
    }
    
    .settings-panel .status {
      color: var(--accent);
      font-size: 1.18rem;
      margin-top: 30px;
      text-align: left;
      font-weight: 600;
      width: 100%;
    }
    
    .settings-panel .panic-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 16px;
      margin-top: 13px;
      width: 100%;
      flex-wrap: wrap;
    }
    
    kbd {
      background: var(--tile-bg);
      padding: 4px 10px;
      border-radius: 6px;
      border: 1.5px solid var(--accent);
      font-weight: 700;
      color: var(--accent);
      font-family: var(--font-big);
    }
    
    /* Topbar */
    .topbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: var(--topbar-height);
      background: var(--topbar-bg);
      backdrop-filter: blur(10px);
      color: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      transition: transform 0.25s ease-out, opacity 0.25s ease-out;
      transform: translateY(-100%);
      opacity: 0;
      overflow-x: hidden;
    }
    
    .topbar.visible {
      transform: translateY(0);
      opacity: 1;
    }
    
    .topbar-content {
      display: flex;
      flex-direction: row;
      gap: 20px;
      align-items: center;
      justify-content: center;
      width: 100vw;
      height: 100%;
    }
    
    .topbar-btn {
      background: var(--accent);
      color: var(--bg);
      border: none;
      border-radius: 12px;
      padding: 10px 24px;
      font-family: var(--font-big);
      font-size: 1.11rem;
      font-weight: 900;
      cursor: pointer;
      margin: 0 4px;
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
      outline: none;
      letter-spacing: 0.09em;
    }
    
    .topbar-btn:hover, .topbar-btn:focus-visible {
      background: var(--bg);
      color: var(--accent);
      transform: translateY(-1px);
    }
    
    /* Announcement popup */
    .annc-popup-bg {
      position: fixed;
      inset: 0;
      background: var(--popup-bg);
      backdrop-filter: blur(5px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity var(--transition-slow);
      opacity: 1;
      pointer-events: all;
    }
    
    .annc-popup-bg.hide {
      opacity: 0;
      pointer-events: none;
    }
    
    .annc-popup {
      background: var(--tile-bg);
      border-radius: 24px;
      box-shadow: 0 2px 44px rgba(0, 0, 0, 0.8);
      padding: 38px 34px;
      max-width: 440px;
      width: 92vw;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--accent);
      font-family: var(--font-big);
      font-size: 1.1rem;
      position: relative;
      animation: slideIn var(--transition-slow) ease-out;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-20px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    
    .annc-title {
      font-size: 2.1rem;
      color: var(--accent);
      margin-bottom: 18px;
      font-weight: 900;
      text-align: center;
      letter-spacing: 0.13em;
    }
    
    .annc-body {
      text-align: center;
      color: var(--text-main);
      font-size: 1.08rem;
      margin-bottom: 16px;
      margin-top: 0;
    }
    
    .annc-btn {
      background: var(--accent);
      color: var(--bg);
      border: none;
      border-radius: 14px;
      padding: 12px 34px;
      font-family: var(--font-big);
      font-size: 1.25rem;
      font-weight: 900;
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
      outline: none;
      margin-top: 18px;
      letter-spacing: 0.09em;
    }
    
    .annc-btn:hover, .annc-btn:focus-visible {
      background: var(--tile-hover-bg);
      color: var(--accent);
      transform: translateY(-2px);
    }
    
    /* Mobile optimizations */
    @media (max-width: 768px) {
      .main-block, .settings-panel, .annc-popup { 
        max-width: 99vw; 
        padding: 18px 7px; 
      }
      .main-logo { 
        width: 70px; 
        height: 70px; 
      }
      .main-title { 
        font-size: 2rem; 
      }
      .topbar-content { 
        gap: 10px; 
      }
      .topbar-btn { 
        font-size: 1rem; 
        padding: 8px 12px; 
      }
      .annc-title { 
        font-size: 1.3rem; 
      }
      .annc-popup { 
        padding: 14px 6px; 
      }
      .settings-panel { 
        padding: 10px 0; 
        max-height: 95vh;
        border-radius: 12px;
        box-shadow: 0 2px 16px rgba(0, 0, 0, 0.25);
      }
      
      /* Touch-friendly mobile topbar */
      .topbar {
        transition: transform 0.3s ease-out, opacity 0.3s ease-out;
      }
    }
    
    /* Reduced motion preferences */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      
      #particles-js {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Enhanced semantic HTML structure and accessibility -->
  <!-- Announcement Popup -->
  <div id="annc-popup-bg" class="annc-popup-bg" style="display:none;" role="dialog" aria-labelledby="annc-title" aria-modal="true">
    <div class="annc-popup">
      <h2 id="annc-title" class="annc-title">ðŸš€ ZXS GAMES Updated!</h2>
      <div class="annc-body">
        Welcome to 3.0.<br>
        <strong>whats there to see?</strong>
        <ul style="margin:12px 0 0 0;padding-left:18px;text-align:left;">
          <li>1. Removed Hacks</li>
          <li>2. Improved UI</li>
          <li>added games and stuffs</li>
          <li>better loading screen</li>
          <li>Enhanced keyboard navigation throughout</li>
        </ul>
      </div>
      <button class="annc-btn" id="annc-close-btn" aria-label="Close announcement">bro i just wanna play</button>
    </div>
  </div>

  <div id="particles-js" aria-hidden="true"></div>
  
  <main class="dashboard-wrap" id="dashboard">
    <div class="main-block" id="main-block">
      <img src="/assets/images/logoV.png" alt="ZXS Games Logo" class="main-logo" />
      <h1 class="main-title">ZXS GAMES</h1>
      <div id="random-message" class="random-message" aria-live="polite"></div>
      <p class="main-subtitle">Welcome to ZXS Games</p>
      <nav class="dashboard-actions" id="dashboard-actions" role="navigation" aria-label="Main navigation">
        <button class="dashboard-action" data-action="games" aria-describedby="games-desc">
          <span class="sr-only" id="games-desc">Access gaming section</span>
          Games
        </button>
        <button class="dashboard-action" data-action="apps" aria-describedby="apps-desc">
          <span class="sr-only" id="apps-desc">Access applications section</span>
          Apps
        </button>
        <button class="dashboard-action" data-action="partners" aria-describedby="partners-desc">
          <span class="sr-only" id="partners-desc">View partner information</span>
          Partners
        </button>
        <button class="dashboard-action" data-action="proxy" aria-describedby="proxy-desc">
          <span class="sr-only" id="proxy-desc">Access pr.xy service</span>
          Proxy
        </button>
        <button class="dashboard-action" data-action="vm" aria-describedby="vm-desc">
          <span class="sr-only" id="vm-desc">Access virtual machine</span>
          VM
        </button>
        <button class="dashboard-action" data-action="settings" aria-describedby="settings-desc">
          <span class="sr-only" id="settings-desc">Open settings panel</span>
          Settings
        </button>
      </nav>
    </div>
  </main>

  <!-- Added proper semantic structure for content sections -->
  <section class="fullscreen-content" id="fullscreen-games" aria-hidden="true">
    <iframe class="fullscreen-iframe" src="/assets/pages/Games.html" title="Games Section"></iframe>
  </section>
  <section class="fullscreen-content" id="fullscreen-apps" aria-hidden="true">
    <iframe class="fullscreen-iframe" src="/assets/pages/apps.html" title="Applications Section"></iframe>
  </section>
  <section class="fullscreen-content" id="fullscreen-partners" aria-hidden="true">
    <iframe class="fullscreen-iframe" src="/assets/pages/partners.html" title="Partners Section"></iframe>
  </section>
  <section class="fullscreen-content" id="fullscreen-proxy" aria-hidden="true">
    <iframe class="fullscreen-iframe" src="/assets/pages/prox.html" title="Pr.xy Service"></iframe>
  </section>
  <section class="fullscreen-content" id="fullscreen-vm" aria-hidden="true">
    <iframe class="fullscreen-iframe" src="/assets/pages/vm/vm.html" title="Virtual Machine"></iframe>
  </section>

  <!-- Improved settings panel with better form structure and accessibility -->
  <div id="fullscreen-settings" role="dialog" aria-labelledby="settings-title" aria-modal="true">
    <div class="settings-panel">
      <h2 id="settings-title">Settings</h2>
      <form class="settings-section" id="settings-form">
        <fieldset class="settings-row">
          <legend class="sr-only">Tab Customization</legend>
          <label for="tab-name">Tab Name</label>
          <input type="text" id="tab-name" placeholder="Enter tab name" autocomplete="off" />
          <button type="button" onclick="applyTabCloak()">Apply Tab Cloak</button>
        </fieldset>
        
        <fieldset class="settings-row">
          <legend class="sr-only">Favicon Settings</legend>
          <label for="favicon-url">Favicon URL</label>
          <input type="url" id="favicon-url" placeholder="Enter favicon URL" autocomplete="off" />
        </fieldset>
        
        <fieldset class="settings-row">
          <legend class="sr-only">Panic Settings</legend>
          <label for="panic-url">Panic Redirect URL</label>
          <input type="url" id="panic-url" placeholder="Enter URL (e.g., https://google.com)" value="https://google.com" autocomplete="off" />
          <button type="button" onclick="savePanicSettings()">Save Panic URL</button>
        </fieldset>
        
        <fieldset class="settings-row">
          <legend>Panic Key Controls</legend>
          <div class="panic-row">
            <span>Current Panic Key: </span>
            <kbd id="current-panic-key" aria-label="Current panic key">]</kbd>
            <button type="button" id="change-panic-key-btn">Change Key</button>
            <span id="listening-status" aria-live="polite"></span>
          </div>
        </fieldset>
        
        <div class="status" id="panic-status" aria-live="polite">Panic key is active</div>
      </form>
    </div>
  </div>

  <!-- Enhanced topbar with better navigation structure -->
  <header class="topbar" id="topbar" role="banner">
    <nav class="topbar-content" role="navigation" aria-label="Top navigation">
      <button class="topbar-btn" data-action="home" aria-label="Go to home">Home</button>
      <button class="topbar-btn" data-action="games" aria-label="Go to games">Games</button>
      <button class="topbar-btn" data-action="apps" aria-label="Go to apps">Apps</button>
      <button class="topbar-btn" data-action="partners" aria-label="Go to partners">Partners</button>
      <button class="topbar-btn" data-action="proxy" aria-label="Go to proxy">Pr.xy</button>
      <button class="topbar-btn" data-action="vm" aria-label="Go to VM">VM</button>
      <button class="topbar-btn" data-action="settings" aria-label="Open settings">Settings</button>
    </nav>
  </header>

  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <!-- Consolidated all JavaScript into single HTML file with performance improvements -->
  <script>
    // Enhanced error handling and performance optimizations
    class ZXSDashboard {
      constructor() {
        this.ANNC_VERSION = "3.0";
        this.panicKey = localStorage.getItem('panicKey') || ']';
        this.panicURL = localStorage.getItem('panicURL') || 'https://google.com';
        this.panicKeyActive = true;
        this.topbarTimeout = null;
        this.mouseOverTop = false;
        this.messageInterval = null;
        
        this.messages = [
          "gaming mode activated",
          "Made with â¤ï¸ by zxs",
          "Hospooot nooo",
          "Whoa cool message",
          "https://dsc.gg/zxsgames",
          "hellow to mi minecraft server",
          "i eat rocks",
          "Minimize this menu bro",
          "i love gamer gaming",
          "hawk tuah",
          "ymntrgbefvdwcsax",
          "noo gambling is very good -evilcy",
          "i bet your reading this",
        ];
        
        this.options = ["games", "apps", "partners", "proxy", "vm", "settings"];
        
        this.init();
      }
      
      init() {
        this.initParticles();
        this.initEventListeners();
        this.initSettings();
        this.displayRandomMessage();
        this.showAnnouncementIfNeeded();
        
        // Start message rotation
        this.messageInterval = setInterval(() => this.displayRandomMessage(), 13000);
      }
      
      initParticles() {
        // Check for reduced motion preference
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
          return;
        }
        
        try {
          particlesJS('particles-js', {
            particles: {
              number: { 
                value: window.innerWidth < 768 ? 25 : 44, 
                density: { enable: true, value_area: 900 } 
              },
              color: { value: "#00ff5e" },
              shape: { type: "circle", stroke: { width: 0, color: "#000000" } },
              opacity: { value: 0.16, random: true },
              size: { value: 2.5, random: true },
              line_linked: { 
                enable: true, 
                distance: 125, 
                color: "#00ff5e", 
                opacity: 0.09, 
                width: 1 
              },
              move: { 
                enable: true, 
                speed: window.innerWidth < 768 ? 0.8 : 1.2, 
                random: true 
              }
            },
            interactivity: {
              detect_on: "canvas",
              events: { 
                onhover: { enable: true, mode: "repulse" }, 
                onclick: { enable: true, mode: "push" }, 
                resize: true 
              },
              modes: { 
                repulse: { distance: 100, duration: 0.4 }, 
                push: { particles_nb: 2 } 
              }
            },
            retina_detect: true
          });
        } catch (error) {
          console.warn('[ZXS] Particles.js failed to load:', error);
        }
      }
      
      initEventListeners() {
        // Dashboard actions
        document.querySelectorAll('.dashboard-action').forEach(btn => {
          btn.addEventListener('click', (e) => {
            this.handleActionClick(e.target.getAttribute('data-action'));
          });
          
          // Keyboard support
          btn.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              this.handleActionClick(e.target.getAttribute('data-action'));
            }
          });
        });
        
        // Topbar actions
        document.querySelectorAll('.topbar-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const action = e.target.getAttribute('data-action');
            if (action === "home") {
              this.showHome();
            } else {
              this.handleActionClick(action);
            }
          });
        });
        
        // Topbar visibility
        this.initTopbarLogic();
        
        // Panic key
        document.addEventListener('keydown', (e) => {
          if (this.panicKeyActive && e.key === this.panicKey) {
            window.location.href = this.panicURL;
          }
          
          // ESC key to close modals
          if (e.key === 'Escape') {
            this.closeModals();
          }
        });
        
        // Announcement popup
        const anncCloseBtn = document.getElementById('annc-close-btn');
        if (anncCloseBtn) {
          anncCloseBtn.addEventListener('click', () => this.closeAnnouncement());
        }
        
        // Settings
        const changePanicKeyBtn = document.getElementById('change-panic-key-btn');
        if (changePanicKeyBtn) {
          changePanicKeyBtn.addEventListener('click', () => this.changePanicKey());
        }
        
        // Window resize optimization
        let resizeTimeout;
        window.addEventListener('resize', () => {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(() => {
            if (window.pJSDom && window.pJSDom[0]) {
              window.pJSDom[0].pJS.fn.canvasSize();
            }
          }, 250);
        });
      }
      
      initTopbarLogic() {
        const topbar = document.getElementById('topbar');
        
        // Mouse/touch events for topbar
        document.body.addEventListener('mousemove', (e) => {
          if (e.clientY < 32) {
            this.showTopbar();
          }
        });
        
        // Touch support for mobile
        document.body.addEventListener('touchstart', (e) => {
          if (e.touches[0].clientY < 50) {
            this.showTopbar();
          }
        });
        
        topbar.addEventListener('mouseenter', () => {
          clearTimeout(this.topbarTimeout);
          topbar.classList.add('visible');
        });
        
        topbar.addEventListener('mouseleave', () => {
          this.hideTopbarDelayed();
        });
      }
      
      showTopbar() {
        const topbar = document.getElementById('topbar');
        if (!this.mouseOverTop) {
          this.mouseOverTop = true;
          topbar.classList.add('visible');
        }
        clearTimeout(this.topbarTimeout);
        this.topbarTimeout = setTimeout(() => {
          this.mouseOverTop = false;
          topbar.classList.remove('visible');
        }, 3000);
      }
      
      hideTopbarDelayed() {
        this.topbarTimeout = setTimeout(() => {
          document.getElementById('topbar').classList.remove('visible');
          this.mouseOverTop = false;
        }, 700);
      }
      
      handleActionClick(action) {
        document.getElementById('dashboard-actions').style.display = 'none';
        this.showFullscreen(action);
      }
      
      showFullscreen(option) {
        // Hide all fullscreen content
        this.options.forEach(opt => {
          const element = document.getElementById('fullscreen-' + opt);
          if (element) {
            element.classList.remove('active');
            element.setAttribute('aria-hidden', 'true');
          }
        });
        
        const settingsElement = document.getElementById('fullscreen-settings');
        if (settingsElement) {
          settingsElement.classList.remove('active');
        }
        
        const mainBlock = document.getElementById('main-block');
        mainBlock.style.opacity = '0';
        mainBlock.style.pointerEvents = 'none';
        
        setTimeout(() => {
          mainBlock.style.display = 'none';
          
          if (option === "settings") {
            settingsElement.classList.add('active');
            const firstInput = settingsElement.querySelector('input');
            if (firstInput) firstInput.focus();
          } else {
            const targetElement = document.getElementById('fullscreen-' + option);
            if (targetElement) {
              targetElement.classList.add('active');
              targetElement.setAttribute('aria-hidden', 'false');
            }
          }
        }, 300);
      }
      
      showHome() {
        this.options.forEach(opt => {
          const element = document.getElementById('fullscreen-' + opt);
          if (element) {
            element.classList.remove('active');
            element.setAttribute('aria-hidden', 'true');
          }
        });
        
        const settingsElement = document.getElementById('fullscreen-settings');
        if (settingsElement) {
          settingsElement.classList.remove('active');
        }
        
        const mainBlock = document.getElementById('main-block');
        mainBlock.style.display = 'flex';
        
        setTimeout(() => {
          mainBlock.style.opacity = '1';
          mainBlock.style.pointerEvents = 'all';
          document.getElementById('dashboard-actions').style.display = 'flex';
          
          const firstButton = document.querySelector('.dashboard-action');
          if (firstButton) firstButton.focus();
        }, 50);
      }
      
      closeModals() {
        const anncPopup = document.getElementById('annc-popup-bg');
        if (anncPopup && anncPopup.style.display !== 'none') {
          this.closeAnnouncement();
          return;
        }
        
        const settings = document.getElementById('fullscreen-settings');
        if (settings && settings.classList.contains('active')) {
          this.showHome();
          return;
        }
      }
      
      displayRandomMessage() {
        try {
          const randomIndex = Math.floor(Math.random() * this.messages.length);
          const messageElement = document.getElementById('random-message');
          if (messageElement) {
            messageElement.textContent = this.messages[randomIndex];
          }
        } catch (error) {
          console.warn('[ZXS] Failed to update random message:', error);
        }
      }
      
      showAnnouncementIfNeeded() {
        const lastSeen = localStorage.getItem("zxs_annc_version");
        if (lastSeen !== this.ANNC_VERSION) {
          const popup = document.getElementById("annc-popup-bg");
          if (popup) {
            popup.style.display = "flex";
            const closeBtn = document.getElementById("annc-close-btn");
            if (closeBtn) closeBtn.focus();
          }
        }
      }
      
      closeAnnouncement() {
        const popup = document.getElementById("annc-popup-bg");
        if (popup) {
          popup.classList.add("hide");
          setTimeout(() => {
            popup.style.display = "none";
          }, 500);
          localStorage.setItem("zxs_annc_version", this.ANNC_VERSION);
        }
      }
      
      initSettings() {
        const currentPanicKeyElement = document.getElementById('current-panic-key');
        const panicUrlElement = document.getElementById('panic-url');
        
        if (currentPanicKeyElement) {
          currentPanicKeyElement.textContent = this.panicKey;
        }
        if (panicUrlElement) {
          panicUrlElement.value = this.panicURL;
        }
      }
      
      changePanicKey() {
        const statusElement = document.getElementById('listening-status');
        if (statusElement) {
          statusElement.textContent = "Listening for key press...";
        }
        
        const keyListener = (e) => {
          e.preventDefault();
          this.panicKey = e.key;
          
          const currentKeyElement = document.getElementById('current-panic-key');
          if (currentKeyElement) {
            currentKeyElement.textContent = this.panicKey;
          }
          
          if (statusElement) {
            statusElement.textContent = "Key set successfully!";
            setTimeout(() => {
              statusElement.textContent = "";
            }, 2000);
          }
          
          document.removeEventListener('keydown', keyListener);
        };
        
        document.addEventListener('keydown', keyListener);
      }
      
      showStatusMessage(message) {
        const panicStatus = document.getElementById('panic-status');
        if (panicStatus) {
          panicStatus.textContent = message;
          setTimeout(() => {
            panicStatus.textContent = "Panic key is active";
          }, 3000);
        }
      }
    }
    
    function applyTabCloak() {
      const tabName = document.getElementById('tab-name').value;
      const faviconUrl = document.getElementById('favicon-url').value;
      
      if (tabName) document.title = tabName;
      if (faviconUrl) {
        const favicon = document.getElementById('favicon');
        if (favicon) favicon.href = faviconUrl;
      }
      
      if (!tabName && !faviconUrl) {
        alert('Please enter both a tab name and favicon URL for full cloaking.');
      } else {
        dashboard.showStatusMessage('Tab cloak applied successfully!');
      }
    }
    
    function savePanicSettings() {
      let panicURL = document.getElementById('panic-url').value;
      
      if (panicURL && !panicURL.startsWith('http://') && !panicURL.startsWith('https://')) {
        panicURL = 'https://' + panicURL;
        document.getElementById('panic-url').value = panicURL;
      }
      
      dashboard.panicURL = panicURL;
      localStorage.setItem('panicKey', dashboard.panicKey);
      localStorage.setItem('panicURL', panicURL);
      dashboard.showStatusMessage("Settings saved successfully!");
    }
    
    let dashboard;
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        dashboard = new ZXSDashboard();
      });
    } else {
      dashboard = new ZXSDashboard();
    }
  </script>
</body>
</html>
